FROM python:3.12.3-bookworm as build

WORKDIR /app
USER root
#RUN apt-get update -y && apt-get install -y wget
RUN wget -P /tmp/ "https://github.com/Tygozwolle/system_sensors/archive/refs/heads/gpu.tar.gz" \
  && tar -xvzf /tmp/gpu.tar.gz -C /app --strip-components 1 
RUN pip install -r /app/requirements.txt 
FROM python:3.12.2-alpine3.19
RUN apk --update-cache add --virtual build-dependencies build-base linux-headers go
RUN GOBIN=/app go install github.com/a8m/envsubst/cmd/envsubst@v1.4.2


RUN apk add bash wireless-tools
RUN apk add bash apt

WORKDIR /app

COPY --from=build /app /app
COPY --from=build /usr/local/lib/python3.12/site-packages /usr/local/lib/python3.12/site-packages
COPY ./ ./
RUN chmod a+x ./system_sensors.sh
RUN chmod a+x ./envsubst
FROM python:3.12.3-bookworm
WORKDIR /app
CMD ./system_sensors.sh

